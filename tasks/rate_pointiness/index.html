<!DOCTYPE html>
<html>
  <head>
    <title>Rate the pointiness</title>
    <script src="jspsych/jspsych.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
    <script src="jspsych/plugin-image-keyboard-response.js"></script>
  </head>
  <body>
  </body>
  <script>
    const jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData('csv');
        const data = jsPsych.data.get();
        console.log(jsPsych.data.get().csv());
        jsPsych.data.get().localSave('csv', 'mydata.csv')
      }
    });

    var timeline = [];


    fetch('./subset_df.csv')
      .then(response => response.text())
      .then((data)=>{
        // const start_idx = Number(data.split("\n")[0]);
        const start_idx = 0;
        // console.log(data);
        console.log("start idx", start_idx);

        const img_each_batch = 200;
        const img_ids = data.split("\n").splice(1, img_each_batch).map((line)=>{
          return line.split(",")[0];
        }).sort(() => Math.random() - 0.5); // shuffled
        //
        console.log("img ids", img_ids);

        img_ids.splice(start_idx, img_each_batch).forEach((img_id, idx)=>{
          var one_trail = {
            type: jsPsychImageKeyboardResponse,
            stimulus: './images/'+img_id+'.jpg',
            choices: ['1', '2', '3', '4', '5', '6', '7'],
            on_finish: function (data) {
              console.log("cur_id", img_id, "idx", start_idx+idx);
            }
          }

          timeline.push(one_trail);
        });

        jsPsych.run(timeline);
      });

  </script>
</html>